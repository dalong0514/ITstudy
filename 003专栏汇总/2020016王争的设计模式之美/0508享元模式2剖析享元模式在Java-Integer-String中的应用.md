# 0508. äº«å…ƒæ¨¡å¼ 2ï¼šå‰–æäº«å…ƒæ¨¡å¼åœ¨ Java Integerã€String ä¸­çš„åº”ç”¨

ç‹äº‰ 2020-03-09

ä¸Šä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬é€šè¿‡æ£‹ç‰Œæ¸¸æˆå’Œæ–‡æœ¬ç¼–è¾‘å™¨è¿™æ ·ä¸¤ä¸ªå®é™…çš„ä¾‹å­ï¼Œå­¦ä¹ äº†äº«å…ƒæ¨¡å¼çš„åŸç†ã€å®ç°ä»¥åŠåº”ç”¨åœºæ™¯ã€‚ç”¨ä¸€å¥è¯æ€»ç»“ä¸€ä¸‹ï¼Œäº«å…ƒæ¨¡å¼ä¸­çš„ã€Œäº«å…ƒã€æŒ‡è¢«å…±äº«çš„å•å…ƒã€‚äº«å…ƒæ¨¡å¼é€šè¿‡å¤ç”¨å¯¹è±¡ï¼Œä»¥è¾¾åˆ°èŠ‚çœå†…å­˜çš„ç›®çš„ã€‚

ä»Šå¤©ï¼Œæˆ‘å†ç”¨ä¸€èŠ‚è¯¾çš„æ—¶é—´å¸¦ä½ å‰–æä¸€ä¸‹ï¼Œäº«å…ƒæ¨¡å¼åœ¨ Java Integerã€String ä¸­çš„åº”ç”¨ã€‚å¦‚æœä½ ä¸ç†Ÿæ‚‰ Java ç¼–ç¨‹è¯­è¨€ï¼Œé‚£ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ï¼Œå› ä¸ºä»Šå¤©çš„å†…å®¹ä¸»è¦è¿˜æ˜¯ä»‹ç»è®¾è®¡æ€è·¯ï¼Œè·Ÿè¯­è¨€æœ¬èº«å…³ç³»ä¸å¤§ã€‚

è¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬æ­£å¼å¼€å§‹ä»Šå¤©çš„å­¦ä¹ å§ï¼

äº«å…ƒæ¨¡å¼åœ¨ Java Integer ä¸­çš„åº”ç”¨

æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹é¢è¿™æ ·ä¸€æ®µä»£ç ã€‚ä½ å¯ä»¥å…ˆæ€è€ƒä¸‹ï¼Œè¿™æ®µä»£ç ä¼šè¾“å‡ºä»€ä¹ˆæ ·çš„ç»“æœã€‚

Integer i1 = 56;


Integer i2 = 56;


Integer i3 = 129;


Integer i4 = 129;


System.out.println(i1 == i2);


System.out.println(i3 == i4);


å¦‚æœä¸ç†Ÿæ‚‰ Java è¯­è¨€ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—ï¼Œi1 å’Œ i2 å€¼éƒ½æ˜¯ 56ï¼Œi3 å’Œ i4 å€¼éƒ½æ˜¯ 129ï¼Œi1 è·Ÿ i2 å€¼ç›¸ç­‰ï¼Œi3 è·Ÿ i4 å€¼ç›¸ç­‰ï¼Œæ‰€ä»¥è¾“å‡ºç»“æœåº”è¯¥æ˜¯ä¸¤ä¸ª trueã€‚è¿™æ ·çš„åˆ†ææ˜¯ä¸å¯¹çš„ï¼Œä¸»è¦è¿˜æ˜¯å› ä¸ºä½ å¯¹ Java è¯­æ³•ä¸ç†Ÿæ‚‰ã€‚è¦æ­£ç¡®åœ°åˆ†æä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦å¼„æ¸…æ¥šä¸‹é¢ä¸¤ä¸ªé—®é¢˜ï¼š

å¦‚ä½•åˆ¤å®šä¸¤ä¸ª Java å¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼ˆä¹Ÿå°±ä»£ç ä¸­çš„ã€Œ==ã€æ“ä½œç¬¦çš„å«ä¹‰ï¼‰ï¼Ÿ

ä»€ä¹ˆæ˜¯è‡ªåŠ¨è£…ç®±ï¼ˆAutoboxingï¼‰å’Œè‡ªåŠ¨æ‹†ç®±ï¼ˆUnboxingï¼‰ï¼Ÿ

åœ¨åŠ é¤ä¸€ä¸­ï¼Œæˆ‘ä»¬è®²åˆ°ï¼ŒJava ä¸ºåŸºæœ¬æ•°æ®ç±»å‹æä¾›äº†å¯¹åº”çš„åŒ…è£…å™¨ç±»å‹ã€‚å…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š

æ‰€è°“çš„è‡ªåŠ¨è£…ç®±ï¼Œå°±æ˜¯è‡ªåŠ¨å°†åŸºæœ¬æ•°æ®ç±»å‹è½¬æ¢ä¸ºåŒ…è£…å™¨ç±»å‹ã€‚æ‰€è°“çš„è‡ªåŠ¨æ‹†ç®±ï¼Œä¹Ÿå°±æ˜¯è‡ªåŠ¨å°†åŒ…è£…å™¨ç±»å‹è½¬åŒ–ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ã€‚å…·ä½“çš„ä»£ç ç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š

Integer i = 56; // è‡ªåŠ¨è£…ç®±

int j = i; // è‡ªåŠ¨æ‹†ç®±

æ•°å€¼ 56 æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ intï¼Œå½“èµ‹å€¼ç»™åŒ…è£…å™¨ç±»å‹ï¼ˆIntegerï¼‰å˜é‡çš„æ—¶å€™ï¼Œè§¦å‘è‡ªåŠ¨è£…ç®±æ“ä½œï¼Œåˆ›å»ºä¸€ä¸ª Integer ç±»å‹çš„å¯¹è±¡ï¼Œå¹¶ä¸”èµ‹å€¼ç»™å˜é‡ iã€‚å…¶åº•å±‚ç›¸å½“äºæ‰§è¡Œäº†ä¸‹é¢è¿™æ¡è¯­å¥ï¼š

Integer i = 59ï¼›åº•å±‚æ‰§è¡Œäº†ï¼šInteger i = Integer.valueOf (59);

åè¿‡æ¥ï¼Œå½“æŠŠåŒ…è£…å™¨ç±»å‹çš„å˜é‡ iï¼Œèµ‹å€¼ç»™åŸºæœ¬æ•°æ®ç±»å‹å˜é‡ j çš„æ—¶å€™ï¼Œè§¦å‘è‡ªåŠ¨æ‹†ç®±æ“ä½œï¼Œå°† i ä¸­çš„æ•°æ®å–å‡ºï¼Œèµ‹å€¼ç»™ jã€‚å…¶åº•å±‚ç›¸å½“äºæ‰§è¡Œäº†ä¸‹é¢è¿™æ¡è¯­å¥ï¼š

int j = i; åº•å±‚æ‰§è¡Œäº†ï¼šint j = i.intValue ();

å¼„æ¸…æ¥šäº†è‡ªåŠ¨è£…ç®±å’Œè‡ªåŠ¨æ‹†ç®±ï¼Œæˆ‘ä»¬å†æ¥çœ‹ï¼Œå¦‚ä½•åˆ¤å®šä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Ÿä¸è¿‡ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¦ææ¸…æ¥šï¼ŒJava å¯¹è±¡åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ã€‚æˆ‘ä»¬é€šè¿‡ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹ã€‚

User a = new User(123, 23); // id=123, age=23


é’ˆå¯¹è¿™æ¡è¯­å¥ï¼Œæˆ‘ç”»äº†ä¸€å¼ å†…å­˜å­˜å‚¨ç»“æ„å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚a å­˜å‚¨çš„å€¼æ˜¯ User å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œåœ¨å›¾ä¸­å°±è¡¨ç°ä¸º a æŒ‡å‘ User å¯¹è±¡ã€‚

å½“æˆ‘ä»¬é€šè¿‡ã€Œ==ã€æ¥åˆ¤å®šä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯åœ¨åˆ¤æ–­ä¸¤ä¸ªå±€éƒ¨å˜é‡å­˜å‚¨çš„åœ°å€æ˜¯å¦ç›¸åŒï¼Œæ¢å¥è¯è¯´ï¼Œæ˜¯åœ¨åˆ¤æ–­ä¸¤ä¸ªå±€éƒ¨å˜é‡æ˜¯å¦æŒ‡å‘ç›¸åŒçš„å¯¹è±¡ã€‚

äº†è§£äº† Java çš„è¿™å‡ ä¸ªè¯­æ³•ä¹‹åï¼Œæˆ‘ä»¬é‡æ–°çœ‹ä¸€ä¸‹å¼€å¤´çš„é‚£æ®µä»£ç ã€‚

Integer i1 = 56;


Integer i2 = 56;


Integer i3 = 129;


Integer i4 = 129;


System.out.println(i1 == i2);


System.out.println(i3 == i4);


å‰ 4 è¡Œèµ‹å€¼è¯­å¥éƒ½ä¼šè§¦å‘è‡ªåŠ¨è£…ç®±æ“ä½œï¼Œä¹Ÿå°±æ˜¯ä¼šåˆ›å»º Integer å¯¹è±¡å¹¶ä¸”èµ‹å€¼ç»™ i1ã€i2ã€i3ã€i4 è¿™å››ä¸ªå˜é‡ã€‚æ ¹æ®åˆšåˆšçš„è®²è§£ï¼Œi1ã€i2 å°½ç®¡å­˜å‚¨çš„æ•°å€¼ç›¸åŒï¼Œéƒ½æ˜¯ 56ï¼Œä½†æ˜¯æŒ‡å‘ä¸åŒçš„ Integer å¯¹è±¡ï¼Œæ‰€ä»¥é€šè¿‡ã€Œ==ã€æ¥åˆ¤å®šæ˜¯å¦ç›¸åŒçš„æ—¶å€™ï¼Œä¼šè¿”å› falseã€‚åŒç†ï¼Œi3==i4 åˆ¤å®šè¯­å¥ä¹Ÿä¼šè¿”å› falseã€‚

ä¸è¿‡ï¼Œä¸Šé¢çš„åˆ†æè¿˜æ˜¯ä¸å¯¹ï¼Œç­”æ¡ˆå¹¶éæ˜¯ä¸¤ä¸ª falseï¼Œè€Œæ˜¯ä¸€ä¸ª trueï¼Œä¸€ä¸ª falseã€‚çœ‹åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šæ¯”è¾ƒçº³é—·äº†ã€‚å®é™…ä¸Šï¼Œè¿™æ­£æ˜¯å› ä¸º Integer ç”¨åˆ°äº†äº«å…ƒæ¨¡å¼æ¥å¤ç”¨å¯¹è±¡ï¼Œæ‰å¯¼è‡´äº†è¿™æ ·çš„è¿è¡Œç»“æœã€‚å½“æˆ‘ä»¬é€šè¿‡è‡ªåŠ¨è£…ç®±ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ valueOf () æ¥åˆ›å»º Integer å¯¹è±¡çš„æ—¶å€™ï¼Œå¦‚æœè¦åˆ›å»ºçš„ Integer å¯¹è±¡çš„å€¼åœ¨ -128 åˆ° 127 ä¹‹é—´ï¼Œä¼šä» IntegerCache ç±»ä¸­ç›´æ¥è¿”å›ï¼Œå¦åˆ™æ‰è°ƒç”¨ new æ–¹æ³•åˆ›å»ºã€‚çœ‹ä»£ç æ›´åŠ æ¸…æ™°ä¸€äº›ï¼ŒInteger ç±»çš„ valueOf () å‡½æ•°çš„å…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

public static Integer valueOf(int i) {


    if (i >= IntegerCache.low && i <= IntegerCache.high)


        return IntegerCache.cache[i + (-IntegerCache.low)];


    return new Integer(i);


}


å®é™…ä¸Šï¼Œè¿™é‡Œçš„ IntegerCache ç›¸å½“äºï¼Œæˆ‘ä»¬ä¸Šä¸€èŠ‚è¯¾ä¸­è®²çš„ç”Ÿæˆäº«å…ƒå¯¹è±¡çš„å·¥å‚ç±»ï¼Œåªä¸è¿‡åå­—ä¸å« xxxFactory è€Œå·²ã€‚æˆ‘ä»¬æ¥çœ‹å®ƒçš„å…·ä½“ä»£ç å®ç°ã€‚è¿™ä¸ªç±»æ˜¯ Integer çš„å†…éƒ¨ç±»ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ JDK æºç ã€‚

/**


 * Cache to support the object identity semantics of autoboxing for values between


 * -128 and 127 (inclusive) as required by JLS.


 *


 * The cache is initialized on first usage.  The size of the cache


 * may be controlled by the {@code -XX:AutoBoxCacheMax=<size>} option.


 * During VM initialization, java.lang.Integer.IntegerCache.high property


 * may be set and saved in the private system properties in the


 * sun.misc.VM class.


 */


private static class IntegerCache {


    static final int low = -128;


    static final int high;


    static final Integer cache[];


    static {


        // high value may be configured by property


        int h = 127;


        String integerCacheHighPropValue =


            sun.misc.VM.getSavedProperty("java.lang.Integer.IntegerCache.high");


        if (integerCacheHighPropValue != null) {


            try {


                int i = parseInt(integerCacheHighPropValue);


                i = Math.max(i, 127);


                // Maximum array size is Integer.MAX_VALUE


                h = Math.min(i, Integer.MAX_VALUE - (-low) -1);


            } catch( NumberFormatException nfe) {


                // If the property cannot be parsed into an int, ignore it.


            }


        }


        high = h;


        cache = new Integer[(high - low) + 1];


        int j = low;


        for(int k = 0; k < cache.length; k++)


            cache[k] = new Integer(j++);


        // range [-128, 127] must be interned (JLS7 5.1.7)


        assert IntegerCache.high >= 127;


    }


    private IntegerCache() {}


}


ä¸ºä»€ä¹ˆ IntegerCache åªç¼“å­˜ -128 åˆ° 127 ä¹‹é—´çš„æ•´å‹å€¼å‘¢ï¼Ÿ

åœ¨ IntegerCache çš„ä»£ç å®ç°ä¸­ï¼Œå½“è¿™ä¸ªç±»è¢«åŠ è½½çš„æ—¶å€™ï¼Œç¼“å­˜çš„äº«å…ƒå¯¹è±¡ä¼šè¢«é›†ä¸­ä¸€æ¬¡æ€§åˆ›å»ºå¥½ã€‚æ¯•ç«Ÿæ•´å‹å€¼å¤ªå¤šäº†ï¼Œæˆ‘ä»¬ä¸å¯èƒ½åœ¨ IntegerCache ç±»ä¸­é¢„å…ˆåˆ›å»ºå¥½æ‰€æœ‰çš„æ•´å‹å€¼ï¼Œè¿™æ ·æ—¢å ç”¨å¤ªå¤šå†…å­˜ï¼Œä¹Ÿä½¿å¾—åŠ è½½ IntegerCache ç±»çš„æ—¶é—´è¿‡é•¿ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªèƒ½é€‰æ‹©ç¼“å­˜å¯¹äºå¤§éƒ¨åˆ†åº”ç”¨æ¥è¯´æœ€å¸¸ç”¨çš„æ•´å‹å€¼ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå­—èŠ‚çš„å¤§å°ï¼ˆ-128 åˆ° 127 ä¹‹é—´çš„æ•°æ®ï¼‰ã€‚

å®é™…ä¸Šï¼ŒJDK ä¹Ÿæä¾›äº†æ–¹æ³•æ¥è®©æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ç¼“å­˜çš„æœ€å¤§å€¼ï¼Œæœ‰ä¸‹é¢ä¸¤ç§æ–¹å¼ã€‚å¦‚æœä½ é€šè¿‡åˆ†æåº”ç”¨çš„ JVM å†…å­˜å ç”¨æƒ…å†µï¼Œå‘ç° -128 åˆ° 255 ä¹‹é—´çš„æ•°æ®å ç”¨çš„å†…å­˜æ¯”è¾ƒå¤šï¼Œä½ å°±å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼ï¼Œå°†ç¼“å­˜çš„æœ€å¤§å€¼ä» 127 è°ƒæ•´åˆ° 255ã€‚ä¸è¿‡ï¼Œè¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼ŒJDK å¹¶æ²¡æœ‰æä¾›è®¾ç½®æœ€å°å€¼çš„æ–¹æ³•ã€‚

// æ–¹æ³•ä¸€ï¼š

-Djava.lang.Integer.IntegerCache.high=255


// æ–¹æ³•äºŒï¼š

-XX:AutoBoxCacheMax=255


ç°åœ¨ï¼Œè®©æˆ‘ä»¬å†å›åˆ°æœ€å¼€å§‹çš„é—®é¢˜ï¼Œå› ä¸º 56 å¤„äº -128 å’Œ 127 ä¹‹é—´ï¼Œi1 å’Œ i2 ä¼šæŒ‡å‘ç›¸åŒçš„äº«å…ƒå¯¹è±¡ï¼Œæ‰€ä»¥ i1==i2 è¿”å› trueã€‚è€Œ 129 å¤§äº 127ï¼Œå¹¶ä¸ä¼šè¢«ç¼“å­˜ï¼Œæ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œi3 å’Œ i4 æŒ‡å‘ä¸åŒçš„ Integer å¯¹è±¡ï¼Œæ‰€ä»¥ i3==i4 è¿”å› falseã€‚

å®é™…ä¸Šï¼Œé™¤äº† Integer ç±»å‹ä¹‹å¤–ï¼Œå…¶ä»–åŒ…è£…å™¨ç±»å‹ï¼Œæ¯”å¦‚ Longã€Shortã€Byte ç­‰ï¼Œä¹Ÿéƒ½åˆ©ç”¨äº†äº«å…ƒæ¨¡å¼æ¥ç¼“å­˜ -128 åˆ° 127 ä¹‹é—´çš„æ•°æ®ã€‚æ¯”å¦‚ï¼ŒLong ç±»å‹å¯¹åº”çš„ LongCache äº«å…ƒå·¥å‚ç±»åŠ valueOf () å‡½æ•°ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š

private static class LongCache {


    private LongCache(){}


    static final Long cache[] = new Long[-(-128) + 127 + 1];


    static {


        for(int i = 0; i < cache.length; i++)


            cache[i] = new Long(i - 128);


    }


}


public static Long valueOf(long l) {


    final int offset = 128;


    if (l >= -128 && l <= 127) { // will cache


        return LongCache.cache[(int)l + offset];


    }


    return new Long(l);


}


åœ¨æˆ‘ä»¬å¹³æ—¶çš„å¼€å‘ä¸­ï¼Œå¯¹äºä¸‹é¢è¿™æ ·ä¸‰ç§åˆ›å»ºæ•´å‹å¯¹è±¡çš„æ–¹å¼ï¼Œæˆ‘ä»¬ä¼˜å…ˆä½¿ç”¨åä¸¤ç§ã€‚

Integer a = new Integer(123);


Integer a = 123;


Integer a = Integer.valueOf(123);


ç¬¬ä¸€ç§åˆ›å»ºæ–¹å¼å¹¶ä¸ä¼šä½¿ç”¨åˆ° IntegerCacheï¼Œè€Œåé¢ä¸¤ç§åˆ›å»ºæ–¹æ³•å¯ä»¥åˆ©ç”¨ IntegerCache ç¼“å­˜ï¼Œè¿”å›å…±äº«çš„å¯¹è±¡ï¼Œä»¥è¾¾åˆ°èŠ‚çœå†…å­˜çš„ç›®çš„ã€‚ä¸¾ä¸€ä¸ªæç«¯ä¸€ç‚¹çš„ä¾‹å­ï¼Œå‡è®¾ç¨‹åºéœ€è¦åˆ›å»º 1 ä¸‡ä¸ª -128 åˆ° 127 ä¹‹é—´çš„ Integer å¯¹è±¡ã€‚ä½¿ç”¨ç¬¬ä¸€ç§åˆ›å»ºæ–¹å¼ï¼Œæˆ‘ä»¬éœ€è¦åˆ†é… 1 ä¸‡ä¸ª Integer å¯¹è±¡çš„å†…å­˜ç©ºé—´ï¼›ä½¿ç”¨åä¸¤ç§åˆ›å»ºæ–¹å¼ï¼Œæˆ‘ä»¬æœ€å¤šåªéœ€è¦åˆ†é… 256 ä¸ª Integer å¯¹è±¡çš„å†…å­˜ç©ºé—´ã€‚

äº«å…ƒæ¨¡å¼åœ¨ Java String ä¸­çš„åº”ç”¨

åˆšåˆšæˆ‘ä»¬è®²äº†äº«å…ƒæ¨¡å¼åœ¨ Java Integer ç±»ä¸­çš„åº”ç”¨ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹ï¼Œäº«å…ƒæ¨¡å¼åœ¨ Java String ç±»ä¸­çš„åº”ç”¨ã€‚åŒæ ·ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼Œä½ è§‰å¾—è¿™æ®µä»£ç è¾“å‡ºçš„ç»“æœæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

String s1 = "å°äº‰å“¥";

String s2 = "å°äº‰å“¥";

String s3 = new String ("å°äº‰å“¥");

System.out.println(s1 == s2);


System.out.println(s1 == s3);


ä¸Šé¢ä»£ç çš„è¿è¡Œç»“æœæ˜¯ï¼šä¸€ä¸ª trueï¼Œä¸€ä¸ª falseã€‚è·Ÿ Integer ç±»çš„è®¾è®¡æ€è·¯ç›¸ä¼¼ï¼ŒString ç±»åˆ©ç”¨äº«å…ƒæ¨¡å¼æ¥å¤ç”¨ç›¸åŒçš„å­—ç¬¦ä¸²å¸¸é‡ï¼ˆä¹Ÿå°±æ˜¯ä»£ç ä¸­çš„ã€Œå°äº‰å“¥ã€ï¼‰ã€‚JVM ä¼šä¸“é—¨å¼€è¾Ÿä¸€å—å­˜å‚¨åŒºæ¥å­˜å‚¨å­—ç¬¦ä¸²å¸¸é‡ï¼Œè¿™å—å­˜å‚¨åŒºå«ä½œã€Œå­—ç¬¦ä¸²å¸¸é‡æ± ã€ã€‚ä¸Šé¢ä»£ç å¯¹åº”çš„å†…å­˜å­˜å‚¨ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š

ä¸è¿‡ï¼ŒString ç±»çš„äº«å…ƒæ¨¡å¼çš„è®¾è®¡ï¼Œè·Ÿ Integer ç±»ç¨å¾®æœ‰äº›ä¸åŒã€‚Integer ç±»ä¸­è¦å…±äº«çš„å¯¹è±¡ï¼Œæ˜¯åœ¨ç±»åŠ è½½çš„æ—¶å€™ï¼Œå°±é›†ä¸­ä¸€æ¬¡æ€§åˆ›å»ºå¥½çš„ã€‚ä½†æ˜¯ï¼Œå¯¹äºå­—ç¬¦ä¸²æ¥è¯´ï¼Œæˆ‘ä»¬æ²¡æ³•äº‹å…ˆçŸ¥é“è¦å…±äº«å“ªäº›å­—ç¬¦ä¸²å¸¸é‡ï¼Œæ‰€ä»¥æ²¡åŠæ³•äº‹å…ˆåˆ›å»ºå¥½ï¼Œåªèƒ½åœ¨æŸä¸ªå­—ç¬¦ä¸²å¸¸é‡ç¬¬ä¸€æ¬¡è¢«ç”¨åˆ°çš„æ—¶å€™ï¼Œå­˜å‚¨åˆ°å¸¸é‡æ± ä¸­ï¼Œå½“ä¹‹åå†ç”¨åˆ°çš„æ—¶å€™ï¼Œç›´æ¥å¼•ç”¨å¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨çš„å³å¯ï¼Œå°±ä¸éœ€è¦å†é‡æ–°åˆ›å»ºäº†ã€‚

é‡ç‚¹å›é¡¾

å¥½äº†ï¼Œä»Šå¤©çš„å†…å®¹åˆ°æ­¤å°±è®²å®Œäº†ã€‚æˆ‘ä»¬ä¸€å—æ¥æ€»ç»“å›é¡¾ä¸€ä¸‹ï¼Œä½ éœ€è¦é‡ç‚¹æŒæ¡çš„å†…å®¹ã€‚

åœ¨ Java Integer çš„å®ç°ä¸­ï¼Œ-128 åˆ° 127 ä¹‹é—´çš„æ•´å‹å¯¹è±¡ä¼šè¢«äº‹å…ˆåˆ›å»ºå¥½ï¼Œç¼“å­˜åœ¨ IntegerCache ç±»ä¸­ã€‚å½“æˆ‘ä»¬ä½¿ç”¨è‡ªåŠ¨è£…ç®±æˆ–è€… valueOf () æ¥åˆ›å»ºè¿™ä¸ªæ•°å€¼åŒºé—´çš„æ•´å‹å¯¹è±¡æ—¶ï¼Œä¼šå¤ç”¨ IntegerCache ç±»äº‹å…ˆåˆ›å»ºå¥½çš„å¯¹è±¡ã€‚è¿™é‡Œçš„ IntegerCache ç±»å°±æ˜¯äº«å…ƒå·¥å‚ç±»ï¼Œäº‹å…ˆåˆ›å»ºå¥½çš„æ•´å‹å¯¹è±¡å°±æ˜¯äº«å…ƒå¯¹è±¡ã€‚

åœ¨ Java String ç±»çš„å®ç°ä¸­ï¼ŒJVM å¼€è¾Ÿä¸€å—å­˜å‚¨åŒºä¸“é—¨å­˜å‚¨å­—ç¬¦ä¸²å¸¸é‡ï¼Œè¿™å—å­˜å‚¨åŒºå«ä½œå­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œç±»ä¼¼äº Integer ä¸­çš„ IntegerCacheã€‚ä¸è¿‡ï¼Œè·Ÿ IntegerCache ä¸åŒçš„æ˜¯ï¼Œå®ƒå¹¶éäº‹å…ˆåˆ›å»ºå¥½éœ€è¦å…±äº«çš„å¯¹è±¡ï¼Œè€Œæ˜¯åœ¨ç¨‹åºçš„è¿è¡ŒæœŸé—´ï¼Œæ ¹æ®éœ€è¦æ¥åˆ›å»ºå’Œç¼“å­˜å­—ç¬¦ä¸²å¸¸é‡ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œè¿™é‡Œæˆ‘å†è¡¥å……å¼ºè°ƒä¸€ä¸‹ã€‚

å®é™…ä¸Šï¼Œäº«å…ƒæ¨¡å¼å¯¹ JVM çš„åƒåœ¾å›æ”¶å¹¶ä¸å‹å¥½ã€‚å› ä¸ºäº«å…ƒå·¥å‚ç±»ä¸€ç›´ä¿å­˜äº†å¯¹äº«å…ƒå¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™å°±å¯¼è‡´äº«å…ƒå¯¹è±¡åœ¨æ²¡æœ‰ä»»ä½•ä»£ç ä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¹¶ä¸ä¼šè¢« JVM åƒåœ¾å›æ”¶æœºåˆ¶è‡ªåŠ¨å›æ”¶æ‰ã€‚å› æ­¤ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ï¼Œä¹Ÿä¸ä¼šè¢«å¯†é›†ä½¿ç”¨ï¼Œåˆ©ç”¨äº«å…ƒæ¨¡å¼åå€’å¯èƒ½ä¼šæµªè´¹æ›´å¤šçš„å†…å­˜ã€‚æ‰€ä»¥ï¼Œé™¤éç»è¿‡çº¿ä¸ŠéªŒè¯ï¼Œåˆ©ç”¨äº«å…ƒæ¨¡å¼çœŸçš„å¯ä»¥å¤§å¤§èŠ‚çœå†…å­˜ï¼Œå¦åˆ™ï¼Œå°±ä¸è¦è¿‡åº¦ä½¿ç”¨è¿™ä¸ªæ¨¡å¼ï¼Œä¸ºäº†ä¸€ç‚¹ç‚¹å†…å­˜çš„èŠ‚çœè€Œå¼•å…¥ä¸€ä¸ªå¤æ‚çš„è®¾è®¡æ¨¡å¼ï¼Œå¾—ä¸å¿å¤±å•Šã€‚

è¯¾å ‚è®¨è®º

IntegerCache åªèƒ½ç¼“å­˜äº‹å…ˆæŒ‡å®šå¥½çš„æ•´å‹å¯¹è±¡ï¼Œé‚£æˆ‘ä»¬æ˜¯å¦å¯ä»¥å€Ÿé‰´ String çš„è®¾è®¡æ€è·¯ï¼Œä¸äº‹å…ˆæŒ‡å®šéœ€è¦ç¼“å­˜å“ªäº›æ•´å‹å¯¹è±¡ï¼Œè€Œæ˜¯åœ¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“ç”¨åˆ°æŸä¸ªæ•´å‹å¯¹è±¡çš„æ—¶å€™ï¼Œåˆ›å»ºå¥½æ”¾ç½®åˆ° IntegerCacheï¼Œä¸‹æ¬¡å†è¢«ç”¨åˆ°çš„æ—¶å€™ï¼Œç›´æ¥ä» IntegerCache ä¸­è¿”å›å‘¢ï¼Ÿ

å¦‚æœå¯ä»¥è¿™ä¹ˆåšï¼Œè¯·ä½ æŒ‰ç…§è¿™ä¸ªæ€è·¯é‡æ–°å®ç°ä¸€ä¸‹ IntegerCache ç±»ï¼Œå¹¶ä¸”èƒ½å¤Ÿåšåˆ°åœ¨æŸä¸ªå¯¹è±¡æ²¡æœ‰ä»»ä½•ä»£ç ä½¿ç”¨çš„æ—¶å€™ï¼Œèƒ½è¢« JVM åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶æ‰ã€‚

æ¬¢è¿ç•™è¨€å’Œæˆ‘åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œå¦‚æœæœ‰æ”¶è·ï¼Œæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚

å°†å­¦åˆ°çš„çŸ¥è¯†æ€»ç»“æˆç¬”è®°ï¼Œæ–¹ä¾¿æ—¥åå¿«é€ŸæŸ¥æ‰¾åŠå¤ä¹ 

unpreview


Â© ç‰ˆæƒå½’æå®¢é‚¦ç§‘æŠ€æ‰€æœ‰ï¼Œæœªç»è®¸å¯ä¸å¾—ä¼ æ’­å”®å–ã€‚é¡µé¢å·²å¢åŠ é˜²ç›—è¿½è¸ªï¼Œå¦‚æœ‰ä¾µæƒæå®¢é‚¦å°†ä¾æ³•è¿½ç©¶å…¶æ³•å¾‹è´£ä»»ã€‚

å¤§é¾™

ç”±ä½œè€…ç­›é€‰åçš„ä¼˜è´¨ç•™è¨€å°†ä¼šå…¬å¼€æ˜¾ç¤ºï¼Œæ¬¢è¿è¸Šè·ƒç•™è¨€ã€‚

Command + Enter å‘è¡¨

0/2000 å­—

æäº¤ç•™è¨€

ç²¾é€‰ç•™è¨€ (30)

Liam


äº«å…ƒæ± ç”¨ weak reference æŒæœ‰äº«å…ƒå¯¹è±¡

2020-03-09


å°æ™å­

å¦‚æœ IntegerCache ä¸äº‹å…ˆæŒ‡å®šç¼“å­˜å“ªäº›æ•´å½¢å¯¹è±¡ï¼Œé‚£ä¹ˆæ¯æ¬¡ç”¨åˆ°çš„æ—¶å€™å» new ä¸€ä¸ªï¼Œè¿™æ ·ä¼šç¨å¾®å½±å“ä¸€äº›æ•ˆç‡ï¼Œå°¤å…¶åœ¨æŸäº›æƒ…å†µä¸‹å¦‚æœå¸¸ç”¨åˆ° - 128~127 ä¹‹é—´çš„æ•°ï¼Œå¯èƒ½ä¼šä¸åœçš„ new/delete, ä¸è¿‡è¿™ä¸ªæ€§èƒ½é—®é¢˜åœ¨å¤§éƒ¨åˆ†æ—¶å€™å½±å“ä¸æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥æŒ‰ç…§ string çš„è®¾è®¡æ€è·¯ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œ

æŒ‰ç…§è¿™ä¸ªæ€è·¯è®¾è®¡ IntegerCache ç±»çš„è¯ï¼Œå¦‚ä¸‹

private static class IntegerCache {


    public static final WeakHashMap<Integer, WeakReference<Integer>> cache =


new WeakHashMap<Integer, WeakReference<Integer>>(); // ä¹Ÿå¯ä»¥æå‰åˆ†é…å®¹é‡

    private IntegerCache(){}


}


public static Integer valueOf(int i) {


    final WeakReference<Integer> cached = IntegerCache.cache.get(i);


    if (cached != null) {


        final Integer value = cached.get(i);


        if (value != null) {


            return value;


        }


    }


    WeakReference<Integer> val = new WeakReference<Integer>(i);


    IntegerCache.cache.put(i, val);


    return val.get();


}


2020-03-09


è¾£ä¹ˆå¤§

è°¢è°¢å„ä½çš„è®¨è®ºï¼Œä»Šå¤©å­¦åˆ°äº†è½¯å¼•ç”¨ï¼Œå¼±å¼•ç”¨ï¼Œå’Œ WeakHashMapã€‚å†…å­˜åƒç´§çš„æ—¶å€™å¯ä»¥è€ƒè™‘ä½¿ç”¨ WeakHashMapã€‚

https://www.baeldung.com/java-weakhashmap


https://www.baeldung.com/java-soft-references


https://www.baeldung.com/java-weak-reference


2020-03-11


æˆæ¥  Peter

è¯¾åé¢˜ã€‚å› ä¸ºæ•´å‹å¯¹è±¡é•¿åº¦å›ºå®šï¼Œä¸”å†…å®¹å›ºå®šï¼Œå¯ä»¥ç›´æ¥ç”³è¯·ä¸€å—è¿ç»­çš„å†…å­˜åœ°å€ï¼Œå¯ä»¥åŠ å¿«è®¿é—®ï¼ŒèŠ‚çœå†…å­˜ï¼Ÿè€Œ String ç±»ä¸è¡Œã€‚

2020-03-09


æå°å››

è®¾è®¡æ¨¡å¼_55:

# ä½œä¸š

åŸæ¥è¿˜æœ‰ä¸ª WeakHashMapï¼Œå­¦ä¹ äº†ã€‚

# æ„Ÿæƒ³

è‡ªå·±å°è¯•äº†å†™äº†ä¸€ä¸ªï¼Œç„¶ååˆ†åˆ«æµ‹è¯•äº† 10,000 æ¬¡ã€100,000 æ¬¡ï¼Œ1,000,000 æ¬¡åˆ›å»ºï¼Œvalue ä» 1-100ï¼Œ100-200ï¼Œ10000-10100ï¼Œå‘ç°ä¸ç®¡å“ªä¸ªåœºæ™¯ï¼Œæ€»æ˜¯ JVM çš„ Integer æ—¶é—´æ›´çŸ­ï¼Œæˆ‘å†™çš„è¦ 3 å€å·¦å³çš„æ—¶é—´ï¼Œä¸ç¦æ„Ÿå¹ï¼ŒJava äºŒåå‡ å¹´äº†ï¼Œå¤§éƒ¨åˆ†çš„ä¼˜åŒ–åº”è¯¥éƒ½åšäº†ï¼Œä¸è¦æœŸæœ›è‡ªå·±èŠ± 20 åˆ†é’Ÿèƒ½æ”¹å‡ºè¶…è¿‡ JVM çš„æ€§èƒ½ã€‚

2020-03-17


Eden Ma


çªç„¶ç†è§£ OC ä¸­ NSString ç­‰ä¹Ÿç”¨åˆ°äº†äº«å…ƒè®¾è®¡æ¨¡å¼.

2020-03-09


webmin


æŠ›ç –å¼•ç‰å®ç°äº†ä¸€ä¸ªæœ‰é™èŒƒå›´çš„ç¼“å­˜ï¼ˆ-128~2048383 (127 * 127 * 127)ï¼‰

public class IntegerCache {


    private static final int bucketSize = 127;


    private static final int level1Max = bucketSize * bucketSize;


    private static final int max = bucketSize * bucketSize * bucketSize;


    private static final WeakHashMap<Integer, WeakHashMap<Integer, WeakHashMap<Integer,WeakReference<Integer>>>> CACHE = new WeakHashMap<>();


    public static Integer intern(int integer) {


        if (integer <= 127) {


            return integer;


        }


        if (integer > max) {


            return integer;


        }


        synchronized (CACHE) {


            Integer l1 = 0;


            int tmp = integer;


            if(integer >= level1Max){


                l1 = integer / level1Max;


                integer -= level1Max;


            }


            Integer l2 = integer / bucketSize;


            Integer mod = integer % bucketSize;


            WeakHashMap<Integer, WeakHashMap<Integer,WeakReference<Integer>>> level1 = CACHE.computeIfAbsent(l1, val -> new WeakHashMap<>());


            WeakHashMap<Integer,WeakReference<Integer>> level2 = level1.computeIfAbsent(l2, val -> new WeakHashMap<>());


            WeakReference<Integer> cache = level2.computeIfAbsent(mod, val -> new WeakReference<>(tmp));


            Integer val = cache.get();


            if (val == null) {


                val = integer;


                level2.put(mod, new WeakReference<>(val));


            }


            return val;


        }


    }


    public static int integersInCache() {


        synchronized (CACHE) {


            int sum = CACHE.size();


            for (Integer key : CACHE.keySet()) {


                WeakHashMap<Integer, WeakHashMap<Integer,WeakReference<Integer>>> tmp = CACHE.get(key);


                sum += tmp.size();


                for(Integer l2Key : tmp.keySet()) {


                    sum += tmp.get(l2Key).size();


                }


            }


            return sum;


        }


    }


}


2020-03-09


æŸ æª¬ C

å¯ä»¥ä½¿ç”¨ weakReferenceï¼Œå½“æ²¡æœ‰å…¶ä»–å˜é‡å¼•ç”¨æ—¶ï¼Œè¢« JVM å›æ”¶

2020-03-14


www.xnsms.com å°é¸Ÿæ¥ç 

æˆ‘å‹’ä¸ªæ“¦ï¼Œè¿™å¥½åƒæ˜¯æˆ‘ç¢°åˆ°çš„ä¸¤é“é¢è¯•é¢˜ï¼ŒåŒ…è£…å’Œæ‹†ç®±è¿™é“é¢˜ç®€ç›´å°±æ˜¯ä¸ªå‘ï¼Œæœ‰è¸©å‘çš„ä¸¾ä¸ªæ‰‹

2020-03-10


é»„æ—æ™´

æ‰“å¡

åš java çš„æˆ‘ç¬¬ä¸€é¢˜ç«Ÿç„¶åšé”™äº†

å¦‚æœå®šä¹‰ä¸º int å°±è¿”å› ture äº†å§ğŸ˜‚

2020-03-09


junshuaizhang


ç»ˆäºå¼„æ˜ç™½å›°æ‰°æˆ‘å¤šå¹´çš„é—®é¢˜äº†ã€‚å¦å¤–è¯„è®ºåŒºå¾ˆå¤šç²¾åå‘€

2020-03-31


ï¼Œ


è¡¥å…… æ·±å…¥ç†è§£ java è™šæ‹Ÿæœº é‡Œçš„ä¸¤é“æœ‰æ„æ€çš„é¢˜ï¼Œè¯·æ€è€ƒè¾“å‡ºç»“æœ:

è‡ªåŠ¨è£…ç®± æ‹†ç®±:

 public static void main(String[] args){


        Integer a = 1;


        Integer b = 2;


        Integer c = 3;


        Integer d = 3;


        Integer e = 321;


        Integer f = 321;


        Long g = 3L;


        System.out.println(c==d);


        System.out.println(e==f);


        System.out.println(c==(a+b));


        System.out.println(c.equals(a+b));


        System.out.println(g ==(a+b));


        System.out.println(g.equals(a+b));


    }


è€ƒå¯ŸçŸ¥è¯†ç‚¹ï¼šInteger ç¼“å­˜ï¼Œequals å’Œ ==

å­—ç¬¦ä¸²:

 public static void main(String[] args) {


String str1 = new StringBuilder ("è®¡ç®—æœº").append ("è½¯ä»¶").toString ();

        System.out.println(str1==str1.intern());


        String str2 = new StringBuilder("ja").append("va").toString();


        System.out.println(str2==str2.intern());


    }


è€ƒå¯ŸçŸ¥è¯†ç‚¹ï¼š1.intern çš„ä½œç”¨ï¼›2. ç©

2020-03-09


Jackey


è¿™èŠ‚çš„ä¾‹å­å¯ä»¥æ‹¿æ¥åšç¬”è¯•çš„é¢˜ç›®ğŸ˜ƒ

2020-03-09


æ¯å¤©æ™’ç™½ç‰™

æ–°çš„ä¸€å‘¨å¼€å§‹äº†ï¼ŒåšæŒè·Ÿä¸‹å»

2020-03-09


å¼ ä¸‰ä¸°

ä¸ºä»€ä¹ˆè¯´åƒåœ¾å›æ”¶çš„æ—¶å€™å¦‚æœä¿å­˜äº†å¯¹è±¡çš„ "å¼•ç”¨" å°±ä¸å‹å¥½ï¼Œåƒåœ¾å›æ”¶çš„ä¾æ®ä¸æ˜¯åªçœ‹è¿™ä¸ªå¯¹è±¡è¿˜æœ‰æ²¡æœ‰è¢« "ä½¿ç”¨" å—ï¼Ÿ

ä½œè€…å›å¤ï¼šæœ‰å¼•ç”¨ï¼Œå°±æ˜¯åœ¨è¢«ä½¿ç”¨å•Š

2020-07-31


å›¾çµæœº

æ›¾ç»ç”¨ == æ¯”è¾ƒä¸¤ä¸ª Integer çš„å€¼ï¼Œç”¨å°äº 127 çš„æ•°æµ‹çš„ä»¿ä½›æ²¡é—®é¢˜ï¼Œé™©äº›é…¿æˆå¤§ç¥¸

2020-07-27


DY


è€å¸ˆçš„æ–‡ç« è¶Šå¾€åé¢è¶Šç‰›

2020-07-26


è¥¿é—¨å¹ç‰›

å¦‚æœ IntegerCache åˆ©ç”¨ String çš„æ€è·¯ï¼Œæ¯æ¬¡ç”¨åˆ°åœ¨ new ï¼Œç„¶åæ”¾ IntegerCache ä¸­ï¼Œå› ä¸º Integer åœ¨ä»£ç ä¸­æ˜¯å¾ˆé¢‘ç¹çš„æ“ä½œï¼Œè¿™äº›æ•°å­—ï¼Œä¸æ–­çš„ newï¼Œè™½ç„¶éƒ½æ˜¯å°å¯¹è±¡ï¼Œä½†æ˜¯ç§¯å°æˆå¤šï¼Œä¹Ÿä¼šå½±å“åƒåœ¾å›æ”¶é¢‘ç¹æ‰§è¡Œ

2020-07-03


å‘å¾€çš„ç”Ÿæ´»

å­¦ä¹ è®¾è®¡æ¨¡å¼çš„è¿‡ç¨‹åˆå¯ä»¥å¤¯å®åŸºç¡€ï¼Œä»¥è®¾è®¡æ¨¡å¼è¯¾ç¨‹ä¸ºç‚¹ï¼Œä¸²èµ·æ¥ä¸€ä¸ªåˆä¸€ä¸ªçš„çŸ¥è¯†çº¿ï¼Œä¸é”™ä¸é”™ã€‚

2020-07-02


æå¾·æ”¿

ç»ˆäºæ˜ç™½äº† Python ä¸­ [-5,256) ä¹‹é—´çš„æ•´æ•°çš„åœ°å€ id éƒ½æ˜¯ä¸€æ ·çš„

2020-06-19


Edward Lee


æˆ‘å€’æ˜¯æƒ³äº†è§£ä¸€ä¸‹ String å¸¸é‡æ± çš„æœ€å¤§èƒ½ç¼“å­˜çš„å¤§å°

2020-05-08


æ¢¦å€šæ æ†

å¯¹äº string çš„ç¼“å­˜æ± ä¹Ÿæ˜¯ç”¨çš„å¼±å¼•ç”¨æˆ–è€…è½¯å¼•ç”¨å—ï¼Ÿ

ä¸ç„¶æ€ä¹ˆçŸ¥é“ä½•æ—¶å›æ”¶å‘¢ï¼Ÿ

2020-03-27


Q ç½—

äº«å…ƒæ¨¡å¼è®²è§£å¾ˆé€å½»ï¼ŒèµğŸ‘

2020-03-24


LğŸš²ğŸ±


æ‰“å¡ï¼Œå­¦ä¹ äº†ï¼Œinteger å’Œ string çš„é¢˜éƒ½ç­”å¯¹äº†ï¼Œä¸è¿‡ï¼Œå…·ä½“çš„åŸç†è¿˜æ˜¯çœ‹äº†æºç æ‰çŸ¥é“çš„ğŸ˜‚

2020-03-16


Michael


get äº†

2020-03-16


Heaven


Java çš„ String å†…éƒ¨ç»´æŒçš„å¸¸é‡æ± æ˜¯æ”¾åœ¨äº†æˆ‘ä»¬çš„æ°¸ä¹…ä»£ç©ºé—´ï¼Œç°åœ¨æ¥è¯´ä¹Ÿå¯èƒ½è¢«ç§°ä¸ºå…ƒç©ºé—´çš„åœ°æ–¹ï¼Œæ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬æ‰€ä»¥ç°åœ¨æ‰€ç†ŸçŸ¥ HotVM ä¹Ÿå¯¹å…¶æ‹¥æœ‰çš„åˆç†çš„åƒåœ¾å›æ”¶ï¼Œæˆ‘ä»¬æ²¡æ³•åƒ String é‚£æ ·åœ¨æ°¸ä¹…ä»£ç©ºé—´å½“ä¸­å¼€è¾Ÿä¸€ç‰‡å†…å­˜åœ°å€çš„è¯ï¼Œæˆ‘ä»¬å°±åªèƒ½è€ƒè™‘ä½¿ç”¨ JVM å½“ä¸­çš„å¼±å¼•ç”¨å»å®ç°å®ƒï¼Œåˆ©ç”¨å¼±å¼•ç”¨ç„¶ååœ¨ valueOf (() å‡½æ•°å½“ä¸­å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬çš„å¯¹è±¡æ± ä¸­ï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ª intern () å‡½æ•°æ¥è®©ç”¨æˆ·æ‰‹åŠ¨çš„è®²è¿™ä¸ª int å¯¹è±¡å¡è¿›æˆ‘ä»¬çš„å¸¸é‡æ± 

2020-03-12


å®ˆæ‹™

æ€»ç»“:

1. äº«å…ƒæ¨¡å¼åœ¨ JDK Integer ç­‰åŒ…è£…ç±»å‹ä¸­æœ‰ä½œä¸ºç¼“å­˜ä½¿ç”¨ (åœ¨ String ç±»ä¸­ä¹Ÿæœ‰ä½¿ç”¨), åœ¨ç±»è¢« ClassLoader åŠ è½½æ—¶å³åˆå§‹åŒ–å¸¸ç”¨çš„å€¼.

2. é™¤éç»è¿‡éªŒè¯ä½¿ç”¨äº«å…ƒæ¨¡å¼ä½œä¸ºç¼“å­˜èƒ½æå‡æ•ˆç‡ï¼Œå¦åˆ™åº”æ…ç”¨äº«å…ƒæ¨¡å¼ï¼Œé¿å…è¿‡åº¦è®¾è®¡.

2020-03-10


VicentğŸ€


çªç„¶æƒ³åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæ± æŠ€æœ¯æœ‰æ²¡æœ‰ç±»ä¼¼äº«å…ƒè®¾è®¡æ¨¡å¼çš„å­˜åœ¨ï¼Œå…¬ç”¨å¯¹è±¡ï¼Œä¸è¿‡ä¼šå¢åŠ ä¸€äº›ä½¿ç”¨é™åˆ¶

2020-03-10


webmin


// è°ƒç”¨ä¾‹å­

public class FlyweightExample {


    public static void main(String[] args) {


        Integer i = IntegerCache.intern(16129);


        System.out.println("16129:" + i);


        i = IntegerCache.intern(1612);


        System.out.println("1612:" + i);


        i = IntegerCache.intern(161);


        System.out.println("161:" + i);


        i = IntegerCache.intern(127);


        System.out.println("127:" + i);


        i = IntegerCache.intern(100);


        System.out.println("100:" + i);


        i = IntegerCache.intern(16129);


        System.out.println("16129:" + i);


        i = IntegerCache.intern(1612);


        System.out.println("1612:" + i);


        i = IntegerCache.intern(161);


        System.out.println("161:" + i);


        i = IntegerCache.intern(2048383);


        System.out.println("2048383:" + i);


        i = IntegerCache.intern(16130);


        System.out.println("16130:" + i);


        i = IntegerCache.intern(2048383);


        System.out.println("2048383:" + i);


        i = IntegerCache.intern(16130);


        System.out.println("16130:" + i);


        System.out.println("Integer objects in cache: " + IntegerCache.integersInCache());


    }


}


2020-03-09


Frank


æ‰“å¡ ä»Šå¤©å­¦ä¹ äº«å…ƒæ¨¡å¼ï¼ˆä¸‹ï¼‰ï¼Œæ”¶è·è¿›ä¸€æ­¥åŠ æ·±äº†å¯¹ String ç±»çš„å­—ç¬¦ä¸²å¸¸é‡æ± çš„ç†è§£ã€‚åœ¨ jdk ä¸­ Integer å’Œ String éƒ½ä½¿ç”¨äº†äº«å…ƒæ¨¡å¼æ¥å­˜å‚¨äº«å…ƒå¯¹è±¡ã€‚

Integer ç±»ä¼šå­˜å‚¨ - 128~127 ä¹‹é—´çš„æ•°å­—å¯¹åº”çš„åŒ…è£…ç±»å‹å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡çš„åˆ›å»ºæ—¶åœ¨ç±»åˆå§‹åŒ–é˜¶æ®µå°±åˆ›å»ºå¥½çš„ã€‚String ç±»åœ¨è¿è¡Œæ—¶ä½¿ç”¨ JVM æä¾›çš„ä¸€å—ç§°ä¹‹ä¸ºã€Œå­—ç¬¦ä¸²å¸¸é‡æ± ã€çš„åŒºåŸŸä¸­æ¥å­˜å‚¨é¦–æ¬¡ä½¿ç”¨åˆ°çš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œå½“åé¢å†æ¬¡ä½¿ç”¨åˆ°è¯¥å¸¸é‡æ—¶ï¼Œç›´æ¥å»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å–å‡ºå¼•ç”¨ä½¿ç”¨å³å¯ã€‚ç”±äºä½¿ç”¨å·¥å‚æ¥æ¥å­˜å‚¨äº«å…ƒå¯¹è±¡ï¼Œä½¿å¾—äº«å…ƒå¯¹è±¡åœ¨ JVM çš„æ ¹æœç´¢ç®—æ³•ä¸­ GC Roots å¯è¾¾ï¼Œå› æ­¤åƒåœ¾å›æ”¶æ•ˆæœä¸å‹å¥½ã€‚

è¯¾å ‚è®¨è®ºé¢˜ä¸­çš„ã€Œå¹¶ä¸”èƒ½å¤Ÿåšåˆ°åœ¨æŸä¸ªå¯¹è±¡æ²¡æœ‰ä»»ä½•ä»£ç ä½¿ç”¨çš„æ—¶å€™ï¼Œèƒ½è¢« JVM åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶æ‰ã€å¯¹åƒåœ¾å›æ”¶æœºåˆ¶ç†è§£ä¸æ·±ï¼Œä¸çŸ¥é“æœ‰å•¥å¥½åŠæ³•ã€‚

2020-03-09


