### 01. 使用

insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Desktop/output.wav --device mps --transcript-path /Users/Daglas/Desktop/output.json --batch-size 4






2024-03-08

insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Desktop/output.wav --device mps --transcript-path /Users/Daglas/Desktop/output.json --batch-size 4


ffmpeg -i /Users/Daglas/Movies/dalong.KnowledgeVideo/2024008AI生产力跃迁/20240302老阳闭门会-站在300年繁荣的起点.mkv -ar 16000 -ac 1 -c:a pcm_s16le /Users/Daglas/Desktop/output.wav


ffmpeg -i /Users/Daglas/Movies/dalong.KnowledgeVideo/2024007人类基本知识工程/20240225人类基本知识工程-CH01元知识.mkv -ss 2997 -t 2226 /Users/Daglas/Desktop/output.wav


ffmpeg -i /Users/Daglas/Downloads/20240304原始-控制室方案模块培训.mp4 -ss 148 -t 1249 /Users/Daglas/Desktop/output.mp4



2024-03-05

ffmpeg -i /Users/Daglas/Downloads/20240304部门质询会议.m4a -ar 16000 -ac 1 -c:a pcm_s16le /Users/Daglas/Downloads/20240304部门质询会议.wav

ffmpeg -i /Users/Daglas/Downloads/20240304部门质询会议.wav -ss 1575 -t 985 /Users/Daglas/Desktop/output.wav

insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Desktop/output.wav --device mps --transcript-path /Users/Daglas/Desktop/output.json



2024-02-19

ffmpeg -i /Users/Daglas/Movies/dalong.KnowledgeVideo/2024006信息分析十三期/CH0001信息分析3.0课程介绍.mkv -ar 16000 -ac 1 -c:a pcm_s16le /Users/Daglas/Desktop/output.wav

insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Desktop/output.wav --device mps --transcript-path /Users/Daglas/Desktop/output.json





2024-02-18

ffmpeg -i /Users/Daglas/Movies/dalong.KnowledgeVideo/2024007人类基本知识工程/CH0104Part421世纪的人类基本知识工程.mkv -ar 16000 -ac 1 -c:a pcm_s16le /Users/Daglas/Desktop/output.wav

insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Desktop/output.wav --device mps --transcript-path /Users/Daglas/Desktop/output.json



2024-01-17

ffmpeg -i /Users/Daglas/Downloads/20240117与吴晓聊2024年工作计划.m4a -ar 16000 -ac 1 -c:a pcm_s16le /Users/Daglas/Downloads/20240117与吴晓聊2024年工作计划.wav

ffmpeg -i /Users/Daglas/Downloads/20240117与吴晓聊2024年工作计划.wav -ss 0 -t 2200 /Users/Daglas/Desktop/output.wav

ffmpeg -i /Users/Daglas/Downloads/20240117与吴晓聊2024年工作计划.wav -ss 2200 -t 2240 /Users/Daglas/Desktop/output.wav



insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Desktop/output.wav --device mps --transcript-path /Users/Daglas/Desktop/output.json



2024-01-09

insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Downloads/20240109数字化研究院部门会议.wav --device mps --transcript-path /Users/Daglas/Desktop/output.json



ffmpeg -i /Users/Daglas/Desktop/20240109数字化研究院部门会议.wav -ss 0 -t 770 /Users/Daglas/Desktop/output.wav


2023-12-25

ffmpeg -i /Users/Daglas/Downloads/20230803与吴总汇报各专业作业线框架.m4a -ar 16000 -ac 1 -c:a pcm_s16le /Users/Daglas/Downloads/20230803与吴总汇报各专业作业线框架.wav



ffmpeg -i /Users/Daglas/Downloads/20230803与吴总汇报各专业作业线框架.wav -ss 4200 -t 1400 /Users/Daglas/Desktop/output.wav


5669

insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Desktop/output.wav --device mps --transcript-path /Users/Daglas/Desktop/output.json



2023-12-23

ffmpeg -i /Users/Daglas/Desktop/W2Ch04抽样阅读20231223.mkv -ss 0 -t 5415 /Users/Daglas/Desktop/output.mkv

ffmpeg -i /Users/Daglas/Desktop/W2Ch04抽样阅读20231223.mkv -ss 5415 -t 5585 /Users/Daglas/Desktop/output.mkv

ffmpeg -i /Users/Daglas/Movies/dalong.KnowledgeVideo/2023019阅读大法训练营/20231223阳志平答疑讲结构阅读.mkv -ar 16000 -ac 1 -c:a pcm_s16le /Users/Daglas/Movies/dalong.KnowledgeVideo/2023019阅读大法训练营/20231223阳志平答疑讲结构阅读.wav

insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Movies/dalong.KnowledgeVideo/2023019阅读大法训练营/20231223阳志平答疑讲结构阅读.wav --device mps --transcript-path /Users/Daglas/Desktop/output.json


2023-12-22

insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Movies/dalong.KnowledgeVideo/2023020卢菁大模型教程/0401卢菁-模型微调实战和经验分享.wav --device mps --transcript-path /Users/Daglas/Desktop/output.json



insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Desktop/20200526电气培训.wav --device mps --transcript-path /Users/Daglas/Desktop/20200526电气培训.json




ffmpeg -i /Users/Daglas/Movies/dalong.KnowledgeVideo/2023020卢菁大模型教程/0401卢菁-模型微调实战和经验分享.mp4 -ar 16000 -ac 1 -c:a pcm_s16le /Users/Daglas/Movies/dalong.KnowledgeVideo/2023020卢菁大模型教程/0401卢菁-模型微调实战和经验分享.wav


insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Movies/dalong.KnowledgeVideo/2023020卢菁大模型教程/0101卢菁-ChatGLM-ChatGPT.wav --device mps --transcript-path /Users/Daglas/Desktop/output.json





/Users/Daglas/Desktop/20200526电气培训.wav


2023-12-17

转音频格式：

ffmpeg -i /Users/Daglas/Music/dalong.knowledgeAudio/2023004公司相关/20231216公司智慧管理研究会01.m4a -ar 16000 -ac 1 -c:a pcm_s16le /Users/Daglas/Music/dalong.knowledgeAudio/2023004公司相关/20231216公司智慧管理研究会01.wav

切割音频：

ffmpeg -i /Users/Daglas/Music/dalong.knowledgeAudio/2023004公司相关/20231216公司智慧管理研究会01.wav -ss 760 -t 860 /Users/Daglas/Desktop/output.wav

转录：

insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Desktop/output.wav --device mps --transcript-path /Users/Daglas/Desktop/output.json


2023-12-12

ffmpeg -i /Users/Daglas/Desktop/20231210HAZOP对话演示02.mkv -ss 37 -t 102 /Users/Daglas/Desktop/02.mkv



使用concat过滤器

如果视频流需要转码，你可以使用concat过滤器。这种方法会重新编码视频，允许你合并不同编码或格式的视频，但是会更耗时一些。

创建一个文本文件（例如mylist.txt），列出所有要合并的视频文件，格式如下：

file '/Users/Daglas/Desktop/01.mkv'
file '/Users/Daglas/Desktop/02.mkv'

使用ffmpeg运行concat过滤器：

ffmpeg -f concat -safe 0 -i mylist.txt -c copy output.mp4

ffmpeg -f concat -safe 0 -i mylist.txt -c copy output.mkv

这里的-c copy参数表示使用复制模式，这意味着不对视频流和音频流进行重新编码，所以操作会很快，但前提是所有视频文件的编解码器、分辨率等都必须相同。





2023-12-10

/Users/Daglas/Movies/dalong.KnowledgeVideo/2023005AI编程课/20231210W7大作业指导分享.wav

上面的音频，1h40min 的，很轻松转出来的。现在越来越怀疑与音频中有多少个人讲话有关。


2023-12-09

目前最大的问题，时长多的时候经常内存占用爆掉，超 150G 了。开始以外是 2h 以上时长的原因，切割为 2h 文件后还是爆掉，现在怀疑跟说话的人数有关。

解决方案尝试 1：从 large-v3 切换 large-v2 模型文件。结果：还是跑不通，一样的情况。



1、先转源音频文件。

ffmpeg -i input.mp3 -ar 16000 -ac 1 -c:a pcm_s16le output.wav

ffmpeg -i input.mkv -ar 16000 -ac 1 -c:a pcm_s16le output.wav

ffmpeg -i /Users/Daglas/Music/dalong.knowledgeAudio/2023001数智设计/20230713舒伟杰HAZOP分析培训.m4a -ar 16000 -ac 1 -c:a pcm_s16le /Users/Daglas/Music/dalong.knowledgeAudio/2023001数智设计/20230713舒伟杰HAZOP分析培训.wav

ffmpeg -i /Users/Daglas/Movies/dalong.KnowledgeVideo/2023005AI编程课/20231210W7大作业指导分享.mkv -ar 16000 -ac 1 -c:a pcm_s16le /Users/Daglas/Movies/dalong.KnowledgeVideo/2023005AI编程课/20231210W7大作业指导分享.wav


ffmpeg -i /Users/Daglas/Desktop/20200526电气培训.m4a -ar 16000 -ac 1 -c:a pcm_s16le /Users/Daglas/Desktop/20200526电气培训.wav




2、切割音频（超过 2h 以上的）。

这个命令会返回音频的总时长（以秒为单位）。

ffprobe -i /Users/Daglas/Music/dalong.knowledgeAudio/2023001数智设计/20230713舒伟杰HAZOP分析培训.wav -show_entries format=duration -v quiet -of csv="p=0"

返回了 7204 秒。

假设音频的总时长为 T 秒。您可以使用下面的命令来分割它：

ffmpeg -i /Users/Daglas/Music/dalong.knowledgeAudio/2023001数智设计/20230713舒伟杰HAZOP分析培训.wav -ss 0 -t [T/2] part1.wav

ffmpeg -i /Users/Daglas/Music/dalong.knowledgeAudio/2023001数智设计/20230713舒伟杰HAZOP分析培训.wav -ss [T/2] -to T part2.wav

这里，[T/2] 是音频总时长的一半。您需要根据实际的时长来替换这个值。

请确保替换 [T/2] 和 T 为实际的秒数。例如，如果音频总时长为 120 秒，那么 [T/2] 就是 60 秒。

ffmpeg -i /Users/Daglas/Music/dalong.knowledgeAudio/2023001数智设计/20230713舒伟杰HAZOP分析培训.wav -ss 0 -t 3602 /Users/Daglas/Music/dalong.knowledgeAudio/2023001数智设计/20230713舒伟杰HAZOP分析培训part1.wav

ffmpeg -i /Users/Daglas/Music/dalong.knowledgeAudio/2023001数智设计/20230713舒伟杰HAZOP分析培训.wav -ss 3602 -to 7204 /Users/Daglas/Music/dalong.knowledgeAudio/2023001数智设计/20230713舒伟杰HAZOP分析培训part2.wav



原来可以直接切割 mkv 视频的：

ffmpeg -i /Users/Daglas/Movies/dalong.KnowledgeVideo/2023006阳志平相关/20230622深圳读者见面会-全.mkv -ss 0 -t 14700 /Users/Daglas/Movies/dalong.KnowledgeVideo/2023006阳志平相关/20230622深圳读者见面会-全.mkv


3、转录。

insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Desktop/20230705舒伟杰培训HAZOP.mp3  --device mps

insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Music/dalong.knowledgeAudio/2023001数智设计/20230713舒伟杰HAZOP分析培训part1.wav --device mps --transcript-path /Users/Daglas/Music/dalong.knowledgeAudio/2023001数智设计/20230713舒伟杰HAZOP分析培训part1.json

insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Desktop/output.wav --device mps --transcript-path /Users/Daglas/Desktop/output.json

/Users/Daglas/Desktop/20200526电气培训.wav

insanely-fast-whisper --model-name /Users/Daglas/dalong.datasets/whisper-large-v3 --file-name /Users/Daglas/Movies/dalong.KnowledgeVideo/2023005AI编程课/20231210W7大作业指导分享.wav --device mps --transcript-path /Users/Daglas/Movies/dalong.KnowledgeVideo/2023005AI编程课/20231210W7大作业指导分享.json



### 02. 信息资源

[Insanely Fast Whisper: 音频极快转录！](https://mp.weixin.qq.com/s/jGHpSyS0ceXCQa9kv_uc8w)

[chenxwh/insanely-fast-whisper: Incredibly fast Whisper-large-v3](https://github.com/chenxwh/insanely-fast-whisper)

下载模型文件：

[whisper-large-v3 · 模型库](https://www.modelscope.cn/models/AI-ModelScope/whisper-large-v3/summary)

git lfs install
git clone https://www.modelscope.cn/AI-ModelScope/whisper-large-v3.git

### 03. 问题汇总

#### Frequently Asked Questions

[chenxwh/insanely-fast-whisper: Incredibly fast Whisper-large-v3](https://github.com/chenxwh/insanely-fast-whisper)

How to correctly install flash-attn to make it work with insanely-fast-whisper?

Make sure to install it via pipx runpip insanely-fast-whisper install flash-attn --no-build-isolation. Massive kudos to @li-yifei for helping with this.

How to solve an AssertionError: Torch not compiled with CUDA enabled error on Windows?

The root cause of this problem is still unknown, however, you can resolve this by manually installing torch in the virtualenv like python -m pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121. Thanks to @pto2k for all tdebugging this.

How to avoid Out-Of-Memory (OOM) exceptions on Mac?

The mps backend isn't as optimised as CUDA, hence is way more memory hungry. Typically you can run with --batch-size 4 without any issues (should use roughly 12GB GPU VRAM). Don't forget to set --device-id mps.




2023-12-21

1、版本从 0.0.10 升级到 0.0.13 后导致用不了。

怀疑作者升版没考虑 mac 都一些东西。

解决方案：退回到 0.0.10 版本。

方法 1：

pipx install insanely-fast-whisper==0.0.10

报信息，已经存在了 0.0.13 版本，改为强制安装。

pipx install insanely-fast-whisper==0.0.10 --force

退回老版本问题就解决了，也就没用方法 2 了。

方法 2：用 mac 的时光机器把虚拟环境中的 insanely-fast-whisper 包退回去。

路径：

/Users/Daglas/.local/pipx/venvs/insanely-fast-whisper




2023-12-05

坑 1：通过 pip 安装 pipx，而不是用 brew 安装 pipx。

坑 2：自己下载本地大模型 whisper-large-v3。

一直报错说找不到 transformers 里的 openai/whisper-large-v3 文件。也是问 GPT 获得的灵感，需要手动去下在模型文件。

hugging face 上找到了模型文件：

[openai/whisper-large-v3 at main](https://huggingface.co/openai/whisper-large-v3/tree/main)

因速度慢，改成了 modelscope 里下载的。

下载后又遇到个问题，不知道把模型文件放在哪里，transformers 可以识别到，一点头绪都没有。也是无异中看到仓库里调用命令里，有一个命令里包含模型文件：

insanely-fast-whisper --model-name distil-whisper/large-v2 --file-name <filename or URL> 
	
真是豁然开朗。

Traceback (most recent call last):
  File "/Users/Daglas/.local/bin/insanely-fast-whisper", line 8, in <module>
    sys.exit(main())
  File "/Users/Daglas/.local/pipx/venvs/insanely-fast-whisper/lib/python3.10/site-packages/insanely_fast_whisper/cli.py", line 230, in main
    pipe = pipeline(
  File "/Users/Daglas/.local/pipx/venvs/insanely-fast-whisper/lib/python3.10/site-packages/transformers/pipelines/__init__.py", line 782, in pipeline
    config = AutoConfig.from_pretrained(
  File "/Users/Daglas/.local/pipx/venvs/insanely-fast-whisper/lib/python3.10/site-packages/transformers/models/auto/configuration_auto.py", line 1048, in from_pretrained
    config_dict, unused_kwargs = PretrainedConfig.get_config_dict(pretrained_model_name_or_path, **kwargs)
  File "/Users/Daglas/.local/pipx/venvs/insanely-fast-whisper/lib/python3.10/site-packages/transformers/configuration_utils.py", line 622, in get_config_dict
    config_dict, kwargs = cls._get_config_dict(pretrained_model_name_or_path, **kwargs)
  File "/Users/Daglas/.local/pipx/venvs/insanely-fast-whisper/lib/python3.10/site-packages/transformers/configuration_utils.py", line 677, in _get_config_dict
    resolved_config_file = cached_file(
  File "/Users/Daglas/.local/pipx/venvs/insanely-fast-whisper/lib/python3.10/site-packages/transformers/utils/hub.py", line 470, in cached_file
    raise EnvironmentError(
OSError: We couldn't connect to 'https://huggingface.co' to load this file, couldn't find it in the cached files and it looks like openai/whisper-large-v3 is not the path to a directory containing a file named config.json.
Checkout your internet connection or see how to run the library in offline mode at 'https://huggingface.co/docs/transformers/installation#offline-mode'.

坑 3：跑的时候报错说必须用显卡 cuid。

在仓库文件里的 QA 里看到：

How to avoid Out-Of-Memory (OOM) exceptions on Mac?

The mps backend isn't as optimised as CUDA, hence is way more memory hungry. Typically you can run with --batch-size 4 without any issues (should use roughly 12GB GPU VRAM). Don't forget to set --device mps.

然后知道了在跑的命令后后面加选项 --device mps。

坑 4：通过 brew 安装 ffmpeg，而不是用 pip 安装 ffmpeg。

brew install ffmpeg

接着继续跑，提示没安装 ffmpeg，直觉直接用 pip 安装，发现不行。问了 GPT 后改用 brew 安装，跑通了！

### 04. 部署

1、安装 pipx。

pip install pipx


开始用的 brew 安装，应该是没安装完整，后改为用 pip 安装的。安装后设置了全局变量。

brew install pipx

==> Running `brew cleanup pipx`...
Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.
Hide these hints with HOMEBREW_NO_ENV_HINTS (see `man brew`).
==> Caveats
==> pipx
zsh completions have been installed to:
  /opt/homebrew/share/zsh/site-functions


(llm) ➜  ~ pipx install insanely-fast-whisper
  installed package insanely-fast-whisper 0.0.10, installed using Python 3.10.13
  These apps are now globally available
    - insanely-fast-whisper
⚠️  Note: '/Users/Daglas/.local/bin' is not on your PATH environment variable. These apps will not be globally accessible until your
    PATH is updated. Run `pipx ensurepath` to automatically add it, or manually modify your PATH in your shell's config file (i.e.
    ~/.bashrc).


echo 'export PATH="/Users/Daglas/.local/bin:$PATH"' >> ~/.zshrc && source ~/.zshrc


